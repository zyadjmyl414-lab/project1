// ==========================================
// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - i18n Manager
// ==========================================

const translations = {
  ar: {
    app_name: "Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´Ø§Ù…Ù„",
    dashboard: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
    statistics: "Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª",
    users: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
    products: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
    offers: "Ø§Ù„Ø¹Ø±ÙˆØ¶",
    orders: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
    settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
    save: "Ø­ÙØ¸",
    cancel: "Ø¥Ù„ØºØ§Ø¡",
    delete: "Ø­Ø°Ù",
    edit: "ØªØ¹Ø¯ÙŠÙ„",
    add: "Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯",
    search: "Ø¨Ø­Ø«...",
    status: "Ø§Ù„Ø­Ø§Ù„Ø©",
    active: "Ù†Ø´Ø·",
    inactive: "ØºÙŠØ± Ù†Ø´Ø·",
    actions: "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
    name: "Ø§Ù„Ø§Ø³Ù…",
    email: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    phone: "Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„",
    password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
    role: "Ø§Ù„Ø¯ÙˆØ±",
    admin: "Ù…Ø¯ÙŠØ±",
    user: "Ù…Ø³ØªØ®Ø¯Ù…",
    category: "Ø§Ù„ÙØ¦Ø©",
    price: "Ø§Ù„Ø³Ø¹Ø±",
    discount: "Ø§Ù„Ø®ØµÙ…",
    rating: "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…",
    description: "Ø§Ù„ÙˆØµÙ",
    total_users: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
    total_products: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
    total_offers: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶",
    total_orders: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
    site_settings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹",
    site_name: "Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹",
    site_email: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    site_phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
    save_settings: "Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    dark_mode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ",
    light_mode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ",
    confirm_delete: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ",
    success_save: "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­",
    error_occurred: "Ø­Ø¯Ø« Ø®Ø·Ø£",
    // Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
    close: "Ø¥ØºÙ„Ø§Ù‚",
    loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
    no_data: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª",
    confirm: "ØªØ£ÙƒÙŠØ¯",
    back: "Ø±Ø¬ÙˆØ¹",
    next: "Ø§Ù„ØªØ§Ù„ÙŠ",
    previous: "Ø§Ù„Ø³Ø§Ø¨Ù‚",
    of: "Ù…Ù†",
    showing: "Ø¹Ø±Ø¶",
    entries: "Ø¹Ù†Ø§ØµØ±",
    search_placeholder: "Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§...",
    select_option: "Ø§Ø®ØªØ±...",
    yes: "Ù†Ø¹Ù…",
    no: "Ù„Ø§",
  },

  en: {
    app_name: "Al-Shamel Market",
    dashboard: "Dashboard",
    statistics: "Statistics",
    users: "Users",
    products: "Products",
    offers: "Offers",
    orders: "Orders",
    settings: "Settings",
    logout: "Logout",
    save: "Save",
    cancel: "Cancel",
    delete: "Delete",
    edit: "Edit",
    add: "Add New",
    search: "Search...",
    status: "Status",
    active: "Active",
    inactive: "Inactive",
    actions: "Actions",
    name: "Name",
    email: "Email",
    phone: "Phone",
    password: "Password",
    role: "Role",
    admin: "Admin",
    user: "User",
    category: "Category",
    price: "Price",
    discount: "Discount",
    rating: "Rating",
    description: "Description",
    total_users: "Total Users",
    total_products: "Total Products",
    total_offers: "Total Offers",
    total_orders: "Total Orders",
    site_settings: "Site Settings",
    site_name: "Site Name",
    site_email: "Email Address",
    site_phone: "Phone Number",
    save_settings: "Save Settings",
    dark_mode: "Dark Mode",
    light_mode: "Light Mode",
    confirm_delete: "Are you sure you want to delete?",
    success_save: "Saved successfully",
    error_occurred: "An error occurred",
    // Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
    close: "Close",
    loading: "Loading...",
    no_data: "No data available",
    confirm: "Confirm",
    back: "Back",
    next: "Next",
    previous: "Previous",
    of: "of",
    showing: "Showing",
    entries: "entries",
    search_placeholder: "Search here...",
    select_option: "Select...",
    yes: "Yes",
    no: "No",
  },
};

// ==========================================
// Translation Manager Class
// ==========================================

class I18nManager {
  constructor() {
    this.currentLang = localStorage.getItem("app_language") || "ar";
    this.translations = translations;
    this.init();
  }

  init() {
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    this.setLanguage(this.currentLang, false);

    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ù…Ù† ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø£Ø®Ø±Ù‰
    window.addEventListener("storage", (e) => {
      if (e.key === "app_language") {
        this.setLanguage(e.newValue, false);
      }
    });
  }

  setLanguage(lang, save = true) {
    if (!this.translations[lang]) return;

    this.currentLang = lang;
    const isRTL = lang === "ar";

    // 1. ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©
    document.documentElement.dir = isRTL ? "rtl" : "ltr";
    document.documentElement.lang = lang;

    // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
    this.updateContent();

    // 3. ØªØ­Ø¯ÙŠØ« placeholder Ù„Ù„Ø­Ù‚ÙˆÙ„
    this.updatePlaceholders();

    // 4. ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
    this.updateLanguageToggle();

    // 5. ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø±
    this.updateDirectionIcons(isRTL);

    // 6. Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„
    if (save) {
      localStorage.setItem("app_language", lang);
      window.dispatchEvent(
        new CustomEvent("languageChanged", {
          detail: { language: lang, isRTL: isRTL },
        }),
      );
    }

    // 7. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ CSS Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    this.handleDirectionChanges(isRTL);
  }

  updateContent() {
    const elements = document.querySelectorAll("[data-i18n]");

    elements.forEach((element) => {
      const key = element.getAttribute("data-i18n");
      const translation = this.translations[this.currentLang][key];

      if (translation) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± input Ø£Ùˆ textarea
        if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
          if (element.hasAttribute("placeholder")) {
            element.placeholder = translation;
          } else {
            element.value = translation;
          }
        } else {
          element.textContent = translation;
        }
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (title)
    const titleElement = document.querySelector("[data-i18n-title]");
    if (titleElement) {
      const titleKey = titleElement.getAttribute("data-i18n-title");
      if (this.translations[this.currentLang][titleKey]) {
        document.title = this.translations[this.currentLang][titleKey];
      }
    }
  }

  updatePlaceholders() {
    const inputs = document.querySelectorAll("[data-i18n-placeholder]");
    inputs.forEach((input) => {
      const key = input.getAttribute("data-i18n-placeholder");
      if (this.translations[this.currentLang][key]) {
        input.placeholder = this.translations[this.currentLang][key];
      }
    });
  }

  updateLanguageToggle() {
    const toggleBtn = document.getElementById("langToggle");
    if (toggleBtn) {
      const icon = this.currentLang === "ar" ? "ðŸ‡¬ðŸ‡§" : "ðŸ‡¸ðŸ‡¦";
      const text = this.currentLang === "ar" ? "EN" : "Ø¹Ø±Ø¨ÙŠ";
      toggleBtn.innerHTML = `${icon} ${text}`;
      toggleBtn.setAttribute(
        "title",
        this.currentLang === "ar" ? "Switch to English" : "Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©",
      );
    }
  }

  updateDirectionIcons(isRTL) {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù‡Ù… ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    const arrows = document.querySelectorAll(".directional-icon");
    arrows.forEach((icon) => {
      if (isRTL) {
        icon.classList.remove("fa-angle-left", "fa-arrow-left");
        icon.classList.add("fa-angle-right", "fa-arrow-right");
      } else {
        icon.classList.remove("fa-angle-right", "fa-arrow-right");
        icon.classList.add("fa-angle-left", "fa-arrow-left");
      }
    });
  }

  handleDirectionChanges(isRTL) {
    const sidebar = document.querySelector(".admin-sidebar");
    const mainContent = document.querySelector(".admin-main");

    if (sidebar && mainContent) {
      if (isRTL) {
        sidebar.style.right = "0";
        sidebar.style.left = "auto";
        mainContent.style.marginRight = "280px";
        mainContent.style.marginLeft = "0";
      } else {
        sidebar.style.left = "0";
        sidebar.style.right = "auto";
        mainContent.style.marginLeft = "280px";
        mainContent.style.marginRight = "0";
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
    const statIcons = document.querySelectorAll(".stat-icon");
    statIcons.forEach((icon) => {
      if (isRTL) {
        icon.style.marginLeft = "20px";
        icon.style.marginRight = "0";
      } else {
        icon.style.marginRight = "20px";
        icon.style.marginLeft = "0";
      }
    });
  }

  toggleLanguage() {
    const newLang = this.currentLang === "ar" ? "en" : "ar";
    this.setLanguage(newLang);
  }

  // ==========================================
  // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®
  // ==========================================

  getText(key) {
    return this.translations[this.currentLang][key] || key;
  }

  formatNumber(number) {
    if (typeof number !== "number") return number;
    return this.currentLang === "ar"
      ? number.toLocaleString("ar-SA")
      : number.toLocaleString("en-US");
  }

  formatDate(dateString) {
    const date = new Date(dateString);
    const options = { year: "numeric", month: "long", day: "numeric" };
    const locale = this.currentLang === "ar" ? "ar-SA" : "en-US";
    return date.toLocaleDateString(locale, options);
  }

  formatCurrency(amount) {
    const symbol = this.currentLang === "ar" ? "Ø±.Ø³" : "SAR";
    const formatted = this.formatNumber(amount);
    return this.currentLang === "ar"
      ? `${formatted} ${symbol}`
      : `${symbol} ${formatted}`;
  }

  translateElement(element, key) {
    if (this.translations[this.currentLang][key]) {
      element.textContent = this.translations[this.currentLang][key];
    }
  }
}

// ==========================================
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
// ==========================================

let i18n;

document.addEventListener("DOMContentLoaded", () => {
  i18n = new I18nManager();

  const langToggle = document.getElementById("langToggle");
  if (langToggle) {
    langToggle.addEventListener("click", () => i18n.toggleLanguage());
  }

  console.log("Translation system initialized. Language:", i18n.currentLang);
});

// ==========================================
// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© (Global Helpers)
// ==========================================

function t(key) {
  return i18n ? i18n.getText(key) : key;
}

function changeLanguage(lang) {
  if (i18n) i18n.setLanguage(lang);
}

function formatNumber(number) {
  return i18n ? i18n.formatNumber(number) : number;
}

function formatDate(date) {
  return i18n ? i18n.formatDate(date) : date;
}

function formatCurrency(amount) {
  return i18n ? i18n.formatCurrency(amount) : amount;
}
